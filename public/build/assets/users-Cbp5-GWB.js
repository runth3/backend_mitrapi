import{_ as T,m as A,D as P,r,c as N,o as L,w as a,b as s,e as i,t as c,f as $,a as f}from"./app-B2iXRY-s.js";const q={name:"UsersTable",components:{DefaultLayout:P},data:()=>({menuItems:A,search:"",loading:!1,dialog:!1,deleteDialog:!1,lastSortBy:null,lastSortDesc:1,options:{page:1,itemsPerPage:10,sortBy:[],sortDesc:[],groupBy:[],groupDesc:[],multiSort:!1},totalUsers:0,headers:[{title:"Name",key:"name",align:"start",sortable:!0},{title:"Email",key:"email",align:"start",sortable:!0},{title:"Username",key:"username",align:"start",sortable:!0},{title:"Created At",key:"created_at",align:"start",sortable:!0},{title:"Admin",key:"is_admin",align:"start",sortable:!0},{title:"Actions",key:"actions",align:"center",sortable:!1}],users:[],editedIndex:-1,editedItem:{name:"",email:"",username:"",is_admin:!1},defaultItem:{name:"",email:"",username:"",is_admin:!1},userToDelete:null,snackbar:!1,snackbarText:"",snackbarColor:"success",validationErrors:{}}),computed:{formTitle(){return this.editedIndex===-1?"New User":"Edit User"}},methods:{handleTableUpdate(e){this.options={...this.options,page:e.page||1,itemsPerPage:e.itemsPerPage||10,sortBy:[],sortDesc:[],groupBy:[],groupDesc:[],multiSort:!1},e.sortBy&&e.sortBy.length>0&&(this.options.sortBy=e.sortBy,this.options.sortDesc=e.sortDesc),this.fetchUsers()},showSnackbar(e,t="success"){this.snackbarText=e,this.snackbarColor=t,this.snackbar=!0},async fetchUsers(){if(!this.loading){this.loading=!0;try{const{page:e=1,itemsPerPage:t=10,sortBy:n=[],sortDesc:g=[]}=this.options;let p="created_at",l=1;n.length>0&&(p=typeof n[0]=="object"?n[0].key:n[0],this.lastSortBy!==p?(l=1,this.lastSortBy=p):l=this.lastSortDesc===1?0:1,this.lastSortDesc=l);const d=await f.get("/api/users",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},params:{page:e,per_page:t,search:this.search,sort_by:p,sort_desc:l}});this.users=d.data.data,this.totalUsers=d.data.meta.total}catch(e){this.showSnackbar("Error loading users","error"),console.error("Error fetching users:",e)}finally{this.loading=!1}}},handleSearch:z(function(){this.options.page=1,this.fetchUsers()},300),formatDate(e){return new Date(e).toLocaleDateString()},openAddDialog(){this.editedIndex=-1,this.editedItem={...this.defaultItem},this.dialog=!0},editUser(e){this.editedIndex=this.users.indexOf(e),this.editedItem={...e},this.dialog=!0},deleteUser(e){this.userToDelete=e,this.deleteDialog=!0},async confirmDelete(){try{await f.delete(`/api/users/${this.userToDelete.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),this.showSnackbar("User deleted successfully"),await this.fetchUsers(),this.deleteDialog=!1,this.userToDelete=null}catch(e){this.showSnackbar("Error deleting user","error"),console.error("Error deleting user:",e)}},close(){this.dialog=!1,this.validationErrors={},this.$nextTick(()=>{this.editedItem={...this.defaultItem},this.editedIndex=-1})},async save(){try{this.validationErrors={};const e={Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"};this.editedIndex>-1?(await f.put(`/api/users/${this.editedItem.id}`,this.editedItem,{headers:e}),this.showSnackbar("User updated successfully")):(await f.post("/api/users",this.editedItem,{headers:e}),this.showSnackbar("User created successfully")),await this.fetchUsers(),this.close()}catch(e){e.response&&e.response.status===422?(this.validationErrors=e.response.data.errors||{},this.showSnackbar("Please check the form for errors","error")):(this.showSnackbar("An error occurred while saving","error"),console.error("Error saving user:",e))}}},mounted(){this.fetchUsers()}};function z(e,t){let n;return function(...g){clearTimeout(n),n=setTimeout(()=>e.apply(this,g),t)}}function j(e,t,n,g,p,l){const d=r("v-text-field"),u=r("v-col"),h=r("v-icon"),m=r("v-btn"),v=r("v-row"),V=r("v-chip"),S=r("v-data-table-server"),k=r("v-card-title"),w=r("v-switch"),y=r("v-container"),b=r("v-card-text"),U=r("v-spacer"),D=r("v-card-actions"),_=r("v-card"),I=r("v-dialog"),C=r("v-snackbar"),B=r("DefaultLayout");return L(),N(B,{"menu-items":e.menuItems,title:"Users"},{default:a(()=>[s(y,null,{default:a(()=>[s(v,null,{default:a(()=>[s(u,{cols:"12",sm:"6",md:"4"},{default:a(()=>[s(d,{modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=o=>e.search=o),"prepend-inner-icon":"mdi-magnify",label:"Search by name",clearable:"",outlined:"",dense:"",onInput:l.handleSearch},null,8,["modelValue","onInput"])]),_:1}),s(u,{cols:"12",sm:"6",md:"8",class:"text-right"},{default:a(()=>[s(m,{color:"primary",onClick:l.openAddDialog},{default:a(()=>[s(h,{left:""},{default:a(()=>t[11]||(t[11]=[i("mdi-plus")])),_:1}),t[12]||(t[12]=i(" Add User "))]),_:1},8,["onClick"])]),_:1})]),_:1}),s(S,{headers:e.headers,items:e.users,"items-length":e.totalUsers,loading:e.loading,options:e.options,"onUpdate:options":[t[1]||(t[1]=o=>e.options=o),l.handleTableUpdate],"items-per-page":e.options.itemsPerPage,page:e.options.page,"sort-by":e.options.sortBy,"sort-desc":e.options.sortDesc,"footer-props":{"items-per-page-options":[10,25,50],showFirstLastPage:!0,"items-per-page-text":"Rows per page"},class:"elevation-1","must-sort":""},{"item.created_at":a(({item:o})=>[i(c(l.formatDate(o.created_at)),1)]),"item.is_admin":a(({item:o})=>[s(V,{color:o.is_admin?"success":"default",small:""},{default:a(()=>[i(c(o.is_admin?"Yes":"No"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:o})=>[s(h,{small:"",class:"mr-2",onClick:E=>l.editUser(o)},{default:a(()=>t[13]||(t[13]=[i(" mdi-pencil ")])),_:2},1032,["onClick"]),s(h,{small:"",onClick:E=>l.deleteUser(o)},{default:a(()=>t[14]||(t[14]=[i(" mdi-delete ")])),_:2},1032,["onClick"])]),_:1},8,["headers","items","items-length","loading","options","items-per-page","page","sort-by","sort-desc","onUpdate:options"]),s(I,{modelValue:e.dialog,"onUpdate:modelValue":t[6]||(t[6]=o=>e.dialog=o),"max-width":"500px"},{default:a(()=>[s(_,null,{default:a(()=>[s(k,null,{default:a(()=>[$("span",null,c(l.formTitle),1)]),_:1}),s(b,null,{default:a(()=>[s(y,null,{default:a(()=>[s(v,null,{default:a(()=>[s(u,{cols:"12"},{default:a(()=>[s(d,{modelValue:e.editedItem.name,"onUpdate:modelValue":t[2]||(t[2]=o=>e.editedItem.name=o),label:"Name","error-messages":e.validationErrors.name,rules:[o=>!!o||"Name is required"]},null,8,["modelValue","error-messages","rules"])]),_:1}),s(u,{cols:"12"},{default:a(()=>[s(d,{modelValue:e.editedItem.email,"onUpdate:modelValue":t[3]||(t[3]=o=>e.editedItem.email=o),label:"Email",type:"email","error-messages":e.validationErrors.email,rules:[o=>!!o||"Email is required",o=>/.+@.+\..+/.test(o)||"Email must be valid"]},null,8,["modelValue","error-messages","rules"])]),_:1}),s(u,{cols:"12"},{default:a(()=>[s(d,{modelValue:e.editedItem.username,"onUpdate:modelValue":t[4]||(t[4]=o=>e.editedItem.username=o),label:"Username","error-messages":e.validationErrors.username,rules:[o=>!!o||"Username is required"]},null,8,["modelValue","error-messages","rules"])]),_:1}),s(u,{cols:"12"},{default:a(()=>[s(w,{modelValue:e.editedItem.is_admin,"onUpdate:modelValue":t[5]||(t[5]=o=>e.editedItem.is_admin=o),label:"Admin Access"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(D,null,{default:a(()=>[s(U),s(m,{color:"grey darken-1",text:"",onClick:l.close},{default:a(()=>t[15]||(t[15]=[i(" Cancel ")])),_:1},8,["onClick"]),s(m,{color:"primary",text:"",onClick:l.save},{default:a(()=>t[16]||(t[16]=[i("Save")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(I,{modelValue:e.deleteDialog,"onUpdate:modelValue":t[8]||(t[8]=o=>e.deleteDialog=o),"max-width":"400px"},{default:a(()=>[s(_,null,{default:a(()=>[s(k,null,{default:a(()=>t[17]||(t[17]=[i("Delete User")])),_:1}),s(b,null,{default:a(()=>t[18]||(t[18]=[i(" Are you sure you want to delete this user? ")])),_:1}),s(D,null,{default:a(()=>[s(U),s(m,{color:"grey darken-1",text:"",onClick:t[7]||(t[7]=o=>e.deleteDialog=!1)},{default:a(()=>t[19]||(t[19]=[i(" Cancel ")])),_:1}),s(m,{color:"error",text:"",onClick:l.confirmDelete},{default:a(()=>t[20]||(t[20]=[i(" Delete ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(C,{modelValue:e.snackbar,"onUpdate:modelValue":t[10]||(t[10]=o=>e.snackbar=o),color:e.snackbarColor,timeout:3e3,top:!0,right:!0},{actions:a(()=>[s(m,{color:"white",text:"",onClick:t[9]||(t[9]=o=>e.snackbar=!1)},{default:a(()=>t[21]||(t[21]=[i(" Close ")])),_:1})]),default:a(()=>[i(c(e.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["menu-items"])}const R=T(q,[["render",j]]);export{R as default};
