import{a as L}from"./index-t--hEgTQ.js";import{d as M,b as n,e as K,F as R,u as z,_ as O,c as v,w as r,h as P,o as i,i as l,D as A,x as B,l as m,y as k,q as U,E as Z,g as G,V as o,G as S,H as h,t as C}from"./main-DvbPgVvv.js";import{D as H,a as j,b as $,V,c as u,f as J,g as Q,h as W,i as X}from"./DefaultLayout-pjWI6CN4.js";import{B as Y,u as x}from"./useAuth-CyrCXpST.js";const ee=M({name:"UsersDetail",components:{DefaultLayout:H,BaseButton:Y},setup(){const a=R(),s=z(),{logout:I,isAdmin:b}=x(),g=n(!1),D=n(!1),p=n(!1),y=n(null),e=n({name:"",email:"",username:"",phone:"",dob:"",address:"",current_password:"",new_password:"",new_password_confirmation:""}),f=n({}),d=n(null),w=n(b.value?j:$);K(b,t=>{w.value=t?j:$});const E=async()=>{try{g.value=!0;const t=await L.get(`/api/users/${d.value}`,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});e.value.name=t.data.user.name,e.value.email=t.data.user.email,e.value.username=t.data.user.username,e.value.phone=t.data.user.phone,e.value.dob=t.data.user.dob,e.value.address=t.data.user.address,f.value={dataPegawaiSimpeg:t.data.dataPegawaiSimpeg,dataPegawaiAbsen:t.data.dataPegawaiAbsen,dataPegawaiEkinerja:t.data.dataPegawaiEkinerja,userAbsen:t.data.userAbsen,userEkinerja:t.data.userEkinerja}}catch(t){console.error("Failed to fetch User Detail:",t)}finally{g.value=!1}},q=async()=>{if(p.value)try{D.value=!0,await L.put(`/api/users/${d.value}`,e.value,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),e.value.current_password="",e.value.new_password="",e.value.new_password_confirmation=""}catch(t){console.error("Failed to save Users Detail:",t)}finally{D.value=!1}},F=async()=>{try{await I(),s.push({name:"Login"})}catch(t){console.error("Logout failed:",t)}},T=t=>t.replace(/([A-Z])/g," $1").replace(/^./,c=>c.toUpperCase()),_=t=>typeof t=="number"?t.toString():t.replace(/([A-Z])/g," $1").replace(/^./,c=>c.toUpperCase()),N=t=>typeof t=="object"&&t!==null;return d.value=parseInt(a.params.id,10),d.value?E():console.error("User ID not found in route parameters."),{menuItems:w,loading:g,saving:D,valid:p,form:y,usersDetail:e,additionalData:f,userId:d,saveUsersDetail:q,handleLogout:F,formatKey:T,formatSubKey:_,isObject:N}}}),ae={key:1};function le(a,s,I,b,g,D){const p=P("BaseButton"),y=P("default-layout");return i(),v(y,{title:"User Detail","menu-items":a.menuItems,onLogout:a.handleLogout},{default:r(()=>[l(V,null,{default:r(()=>[l(u,{cols:"12",md:"10","offset-md":"1"},{default:r(()=>[l(A,{class:"dashboard-card",elevation:"3"},{default:r(()=>[l(B,null,{default:r(()=>s[10]||(s[10]=[m("User Detail Settings")])),_:1}),l(k,null,{default:r(()=>[a.loading?(i(),v(Z,{key:0,indeterminate:"",color:"primary"})):(i(),U("div",ae,[l(G,{ref:"form",modelValue:a.valid,"onUpdate:modelValue":s[9]||(s[9]=e=>a.valid=e)},{default:r(()=>[l(V,null,{default:r(()=>[l(u,{cols:"12",md:"6"},{default:r(()=>[l(o,{modelValue:a.usersDetail.name,"onUpdate:modelValue":s[0]||(s[0]=e=>a.usersDetail.name=e),label:"Name",rules:[e=>!!e||"Name is required"],required:""},null,8,["modelValue","rules"]),l(o,{modelValue:a.usersDetail.email,"onUpdate:modelValue":s[1]||(s[1]=e=>a.usersDetail.email=e),label:"Email",rules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Email must be valid"],required:""},null,8,["modelValue","rules"]),l(o,{modelValue:a.usersDetail.username,"onUpdate:modelValue":s[2]||(s[2]=e=>a.usersDetail.username=e),label:"Username",rules:[e=>!!e||"Username is required"],required:""},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"6"},{default:r(()=>[l(o,{modelValue:a.usersDetail.phone,"onUpdate:modelValue":s[3]||(s[3]=e=>a.usersDetail.phone=e),label:"Phone"},null,8,["modelValue"]),l(o,{modelValue:a.usersDetail.dob,"onUpdate:modelValue":s[4]||(s[4]=e=>a.usersDetail.dob=e),label:"Date of Birth",type:"date"},null,8,["modelValue"]),l(o,{modelValue:a.usersDetail.address,"onUpdate:modelValue":s[5]||(s[5]=e=>a.usersDetail.address=e),label:"Address"},null,8,["modelValue"])]),_:1})]),_:1}),l(V,null,{default:r(()=>[l(u,{cols:"12",md:"4"},{default:r(()=>[l(o,{modelValue:a.usersDetail.current_password,"onUpdate:modelValue":s[6]||(s[6]=e=>a.usersDetail.current_password=e),label:"Current Password",type:"password",rules:[e=>!e||e.length>=8||"Password must be at least 8 characters"]},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"4"},{default:r(()=>[l(o,{modelValue:a.usersDetail.new_password,"onUpdate:modelValue":s[7]||(s[7]=e=>a.usersDetail.new_password=e),label:"New Password",type:"password",rules:[e=>!e||e.length>=8||"Password must be at least 8 characters"]},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12",md:"4"},{default:r(()=>[l(o,{modelValue:a.usersDetail.new_password_confirmation,"onUpdate:modelValue":s[8]||(s[8]=e=>a.usersDetail.new_password_confirmation=e),label:"Confirm New Password",type:"password",rules:[e=>!e||e===a.usersDetail.new_password||"Passwords must match"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(V,null,{default:r(()=>[l(u,{cols:"12",md:"4"},{default:r(()=>[l(p,{color:"primary",to:{name:"faceModelList",params:{id:a.userId}}},{default:r(()=>s[11]||(s[11]=[m(" Manage Face Models ")])),_:1},8,["to"])]),_:1}),l(u,{cols:"12",md:"4"},{default:r(()=>[l(p,{color:"primary",loading:a.saving,disabled:!a.valid,onClick:a.saveUsersDetail},{default:r(()=>s[12]||(s[12]=[m(" Save Changes ")])),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(V,{class:"mt-4"},{default:r(()=>[(i(!0),U(S,null,h(a.additionalData,(e,f)=>(i(),v(u,{key:f,cols:"12",md:"4"},{default:r(()=>[l(A,{class:"dashboard-card",elevation:"3"},{default:r(()=>[l(B,null,{default:r(()=>[m(C(a.formatKey(f)),1)]),_:2},1024),l(k,null,{default:r(()=>[l(J,null,{default:r(()=>[(i(!0),U(S,null,h(a.isObject(e)?e:[],(d,w)=>(i(),v(Q,{key:w},{default:r(()=>[l(W,null,{default:r(()=>[m(C(a.formatSubKey(w)),1)]),_:2},1024),l(X,null,{default:r(()=>[m(C(d),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["menu-items","onLogout"])}const ue=O(ee,[["render",le],["__scopeId","data-v-fa284f48"]]);export{ue as default};
