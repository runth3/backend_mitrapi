import{_ as $,r as o,g as h,o as v,w as r,e as a,f as l,i as C,t as f,k as q,h as E,b as c}from"./app-ClbCorYk.js";import{m as L,D as z}from"./menu-DXkp5gbb.js";const j={name:"UsersTable",components:{DefaultLayout:z},data:()=>({menuItems:L,search:"",loading:!1,dialog:!1,deleteDialog:!1,options:{page:1,itemsPerPage:10,sortBy:[],sortDesc:[],groupBy:[],groupDesc:[],multiSort:!1},totalUsers:0,headers:[{title:"Name",key:"name",align:"start",sortable:!0},{title:"Email",key:"email",align:"start",sortable:!0},{title:"Username",key:"username",align:"start",sortable:!0},{title:"Created At",key:"created_at",align:"start",sortable:!0},{title:"Admin",key:"is_admin",align:"start",sortable:!0},{title:"Actions",key:"actions",align:"center",sortable:!1}],users:[],editedIndex:-1,editedItem:{name:"",email:"",username:"",password:"",password_confirmation:"",is_admin:!1},defaultItem:{name:"",email:"",username:"",password:"",password_confirmation:"",is_admin:!1},userToDelete:null,snackbar:!1,snackbarText:"",snackbarColor:"success",validationErrors:{}}),computed:{formTitle(){return this.editedIndex===-1?"New User":"Edit User"}},methods:{showSnackbar(e,t="success"){this.snackbarText=e,this.snackbarColor=t,this.snackbar=!0},handleTableUpdate(e){this.options={...this.options,page:e.page||1,itemsPerPage:e.itemsPerPage||10,sortBy:Array.isArray(e.sortBy)?e.sortBy:this.options.sortBy||[],sortDesc:Array.isArray(e.sortDesc)?e.sortDesc:this.options.sortDesc||[]},this.fetchUsers()},async fetchUsers(){if(!this.loading){this.loading=!0;try{const{page:e,itemsPerPage:t,sortBy:n=[]}=this.options;console.log("fetchUsers options:",{sortBy:n});const p=n.length>0?n[0].key:"created_at",k=n.length>0?n[0].order==="desc":!1,i=await c.get("/api/users",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},params:{page:e,per_page:t,search:this.search,sort_by:p,sort_desc:k?1:0}});this.users=i.data.data,this.totalUsers=i.data.meta.total}catch(e){this.showSnackbar("Error loading users","error"),console.error("Error fetching users:",e)}finally{this.loading=!1}}},handleSearch:F(function(){this.options.page=1,this.fetchUsers()},300),formatDate(e){return new Date(e).toLocaleDateString()},openAddDialog(){this.editedIndex=-1,this.editedItem={...this.defaultItem},this.dialog=!0},deleteUser(e){this.userToDelete=e,this.deleteDialog=!0},async confirmDelete(){try{await c.delete(`/api/users/${this.userToDelete.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),this.showSnackbar("User deleted successfully"),await this.fetchUsers(),this.deleteDialog=!1,this.userToDelete=null}catch(e){this.showSnackbar("Error deleting user","error"),console.error("Error deleting user:",e)}},close(){this.dialog=!1,this.validationErrors={},this.$nextTick(()=>{this.editedItem={...this.defaultItem},this.editedIndex=-1})},async save(){try{this.validationErrors={};const e={Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},t={name:this.editedItem.name,email:this.editedItem.email,username:this.editedItem.username,is_admin:this.editedItem.is_admin};this.editedIndex===-1&&(t.password=this.editedItem.password,t.password_confirmation=this.editedItem.password_confirmation),this.editedIndex>-1?(await c.put(`/api/users/${this.editedItem.id}`,t,{headers:e}),this.showSnackbar("User updated successfully")):(await c.post("/api/users",t,{headers:e}),this.showSnackbar("User created successfully")),await this.fetchUsers(),this.close()}catch(e){e.response&&e.response.status===422?(this.validationErrors=e.response.data.errors||{},this.showSnackbar("Please check the form for errors","error")):(this.showSnackbar("An error occurred while saving","error"),console.error("Error saving user:",e))}},viewUser(e){this.$router.push(`/users/${e.id}`)}},mounted(){this.fetchUsers()}};function F(e,t){let n;return function(...p){clearTimeout(n),n=setTimeout(()=>e.apply(this,p),t)}}function M(e,t,n,p,k,i){const m=o("v-text-field"),d=o("v-col"),g=o("v-icon"),u=o("v-btn"),y=o("v-row"),S=o("v-chip"),A=o("v-data-table-server"),w=o("v-card-title"),P=o("v-switch"),b=o("v-container"),I=o("v-card-text"),U=o("v-spacer"),_=o("v-card-actions"),V=o("v-card"),D=o("v-dialog"),T=o("v-snackbar"),B=o("DefaultLayout");return v(),h(B,{"menu-items":e.menuItems,title:"Users"},{default:r(()=>[a(b,null,{default:r(()=>[a(y,null,{default:r(()=>[a(d,{cols:"12",sm:"6",md:"4"},{default:r(()=>[a(m,{modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=s=>e.search=s),"prepend-inner-icon":"mdi-magnify",label:"Search by name",clearable:"",outlined:"",dense:"",onInput:i.handleSearch},null,8,["modelValue","onInput"])]),_:1}),a(d,{cols:"12",sm:"6",md:"8",class:"text-right"},{default:r(()=>[a(u,{color:"primary",onClick:i.openAddDialog},{default:r(()=>[a(g,{left:""},{default:r(()=>t[13]||(t[13]=[l("mdi-plus")])),_:1}),t[14]||(t[14]=l(" Add User "))]),_:1},8,["onClick"])]),_:1})]),_:1}),a(A,{headers:e.headers,items:e.users,"items-length":e.totalUsers,loading:e.loading,options:e.options,"onUpdate:options":[t[1]||(t[1]=s=>e.options=s),i.handleTableUpdate],"items-per-page":e.options.itemsPerPage,page:e.options.page,"footer-props":{"items-per-page-options":[10,25,50],showFirstLastPage:!0,"items-per-page-text":"Rows per page"},class:"elevation-1","must-sort":"","item-key":"id"},{"item.created_at":r(({item:s})=>[l(f(i.formatDate(s.created_at)),1)]),"item.is_admin":r(({item:s})=>[a(S,{color:s.is_admin?"success":"default",small:""},{default:r(()=>[l(f(s.is_admin?"Yes":"No"),1)]),_:2},1032,["color"])]),"item.actions":r(({item:s})=>[a(g,{small:"",class:"mr-2",onClick:C(N=>i.viewUser(s),["stop"]),color:"primary"},{default:r(()=>t[15]||(t[15]=[l(" mdi-pencil ")])),_:2},1032,["onClick"]),a(g,{small:"",onClick:C(N=>i.deleteUser(s),["stop"]),color:"primary"},{default:r(()=>t[16]||(t[16]=[l(" mdi-delete ")])),_:2},1032,["onClick"])]),_:1},8,["headers","items","items-length","loading","options","items-per-page","page","onUpdate:options"]),a(D,{modelValue:e.dialog,"onUpdate:modelValue":t[8]||(t[8]=s=>e.dialog=s),"max-width":"500px"},{default:r(()=>[a(V,null,{default:r(()=>[a(w,null,{default:r(()=>[q("span",null,f(i.formTitle),1)]),_:1}),a(I,null,{default:r(()=>[a(b,null,{default:r(()=>[a(y,null,{default:r(()=>[a(d,{cols:"12"},{default:r(()=>[a(m,{modelValue:e.editedItem.name,"onUpdate:modelValue":t[2]||(t[2]=s=>e.editedItem.name=s),label:"Name","error-messages":e.validationErrors.name,rules:[s=>!!s||"Name is required"]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(d,{cols:"12"},{default:r(()=>[a(m,{modelValue:e.editedItem.email,"onUpdate:modelValue":t[3]||(t[3]=s=>e.editedItem.email=s),label:"Email",type:"email","error-messages":e.validationErrors.email,rules:[s=>!!s||"Email is required",s=>/.+@.+\..+/.test(s)||"Email must be valid"]},null,8,["modelValue","error-messages","rules"])]),_:1}),a(d,{cols:"12"},{default:r(()=>[a(m,{modelValue:e.editedItem.username,"onUpdate:modelValue":t[4]||(t[4]=s=>e.editedItem.username=s),label:"Username","error-messages":e.validationErrors.username,rules:[s=>!!s||"Username is required"]},null,8,["modelValue","error-messages","rules"])]),_:1}),e.editedIndex===-1?(v(),h(d,{key:0,cols:"12"},{default:r(()=>[a(m,{modelValue:e.editedItem.password,"onUpdate:modelValue":t[5]||(t[5]=s=>e.editedItem.password=s),label:"Password",type:"password","error-messages":e.validationErrors.password,rules:[s=>!!s||"Password is required"]},null,8,["modelValue","error-messages","rules"])]),_:1})):E("",!0),e.editedIndex===-1?(v(),h(d,{key:1,cols:"12"},{default:r(()=>[a(m,{modelValue:e.editedItem.password_confirmation,"onUpdate:modelValue":t[6]||(t[6]=s=>e.editedItem.password_confirmation=s),label:"Password Confirmation",type:"password","error-messages":e.validationErrors.password_confirmation,rules:[s=>!!s||"Password Confirmation is required",s=>s===e.editedItem.password||"Password confirmation does not match"]},null,8,["modelValue","error-messages","rules"])]),_:1})):E("",!0),a(d,{cols:"12"},{default:r(()=>[a(P,{modelValue:e.editedItem.is_admin,"onUpdate:modelValue":t[7]||(t[7]=s=>e.editedItem.is_admin=s),label:"Admin Access"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(_,null,{default:r(()=>[a(U),a(u,{color:"grey darken-1",text:"",onClick:i.close},{default:r(()=>t[17]||(t[17]=[l(" Cancel ")])),_:1},8,["onClick"]),a(u,{color:"primary",text:"",onClick:i.save},{default:r(()=>t[18]||(t[18]=[l("Save")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(D,{modelValue:e.deleteDialog,"onUpdate:modelValue":t[10]||(t[10]=s=>e.deleteDialog=s),"max-width":"400px"},{default:r(()=>[a(V,null,{default:r(()=>[a(w,null,{default:r(()=>t[19]||(t[19]=[l("Delete User")])),_:1}),a(I,null,{default:r(()=>t[20]||(t[20]=[l(" Are you sure you want to delete this user? ")])),_:1}),a(_,null,{default:r(()=>[a(U),a(u,{color:"grey darken-1",text:"",onClick:t[9]||(t[9]=s=>e.deleteDialog=!1)},{default:r(()=>t[21]||(t[21]=[l(" Cancel ")])),_:1}),a(u,{color:"error",text:"",onClick:i.confirmDelete},{default:r(()=>t[22]||(t[22]=[l(" Delete ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(T,{modelValue:e.snackbar,"onUpdate:modelValue":t[12]||(t[12]=s=>e.snackbar=s),color:e.snackbarColor,timeout:3e3,top:!0,right:!0},{actions:r(()=>[a(u,{color:"white",text:"",onClick:t[11]||(t[11]=s=>e.snackbar=!1)},{default:r(()=>t[23]||(t[23]=[l(" Close ")])),_:1})]),default:r(()=>[l(f(e.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["menu-items"])}const G=$(j,[["render",M]]);export{G as default};
