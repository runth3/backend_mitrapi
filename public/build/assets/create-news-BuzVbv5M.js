import{d as w,_ as k,r as a,g as d,o as m,w as o,e as n,f as i,t as c,i as N,h as I,c as P,F as T,j as U,b as B}from"./app-ClbCorYk.js";import{D as L,m as j}from"./menu-DXkp5gbb.js";const z=w({name:"NewsForm",props:{title:{type:String,default:"Create News"},submitButtonText:{type:String,default:"Create"},initialData:{type:Object,default:()=>({title:"",content:"",image_url:""})},loading:{type:Boolean,default:!1}},data(){return{valid:!1,formData:{...this.initialData},imageFile:null,imagePreview:null,imageRules:[e=>{if(!e)return!0;const t=5*1024*1024;return e.size>t?"Image size should be less than 5MB!":["image/jpeg","image/png","image/gif","image/webp"].includes(e.type)?!0:"Please upload an image file (JPEG, PNG, GIF, WEBP)"}]}},methods:{handleImageChange(e){e?(this.imagePreview=URL.createObjectURL(e),this.imageFile=e):this.clearImage()},clearImage(){this.imagePreview&&URL.revokeObjectURL(this.imagePreview),this.imagePreview=null,this.imageFile=null},async handleSubmit(){const e=this.$refs.form,{valid:t}=await e.validate();if(t){const s=new FormData;s.append("title",this.formData.title),s.append("content",this.formData.content),this.imageFile&&s.append("image",this.imageFile),this.$emit("submit",s)}}},beforeUnmount(){this.clearImage()},watch:{initialData:{handler(e){this.formData={...e},e.image_url&&(this.imagePreview=e.image_url)},immediate:!0}}});function R(e,t,s,u,C,y){const p=a("v-card-title"),f=a("v-text-field"),g=a("v-textarea"),v=a("v-chip"),h=a("v-file-input"),b=a("v-img"),r=a("v-btn"),$=a("v-col"),S=a("v-row"),D=a("v-form"),V=a("v-card-text"),F=a("v-card");return m(),d(F,null,{default:o(()=>[n(p,null,{default:o(()=>[i(c(e.title),1)]),_:1}),n(V,null,{default:o(()=>[n(D,{ref:"form",modelValue:e.valid,"onUpdate:modelValue":t[4]||(t[4]=l=>e.valid=l),onSubmit:N(e.handleSubmit,["prevent"])},{default:o(()=>[n(f,{modelValue:e.formData.title,"onUpdate:modelValue":t[0]||(t[0]=l=>e.formData.title=l),rules:[l=>!!l||"Title is required"],label:"Title",required:"",variant:"outlined","full-width":"",class:"mb-4"},null,8,["modelValue","rules"]),n(g,{modelValue:e.formData.content,"onUpdate:modelValue":t[1]||(t[1]=l=>e.formData.content=l),rules:[l=>!!l||"Content is required"],label:"Content",required:"",variant:"outlined","full-width":"",class:"mb-4",rows:"10","auto-grow":""},null,8,["modelValue","rules"]),n(h,{modelValue:e.imageFile,"onUpdate:modelValue":t[2]||(t[2]=l=>e.imageFile=l),rules:e.imageRules,accept:"image/*",label:"News Image",variant:"outlined","prepend-icon":"mdi-camera","full-width":"",class:"mb-4",onChange:e.handleImageChange,"show-size":!0},{selection:o(({fileNames:l})=>[(m(!0),P(T,null,U(l,_=>(m(),d(v,{key:_,size:"small",label:"",color:"primary",class:"me-2"},{default:o(()=>[i(c(_),1)]),_:2},1024))),128))]),_:1},8,["modelValue","rules","onChange"]),e.imagePreview?(m(),d(b,{key:0,src:e.imagePreview,"max-height":"200",contain:"",class:"mb-4"},null,8,["src"])):I("",!0),n(S,null,{default:o(()=>[n($,{cols:"12",class:"d-flex justify-end"},{default:o(()=>[n(r,{color:"secondary",variant:"text",class:"mr-2",onClick:t[3]||(t[3]=l=>e.$emit("cancel"))},{default:o(()=>t[5]||(t[5]=[i(" Cancel ")])),_:1}),n(r,{color:"primary",type:"submit",loading:e.loading,disabled:!e.valid},{default:o(()=>[i(c(e.submitButtonText),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})}const q=k(z,[["render",R]]),E=w({name:"CreateNews",components:{DefaultLayout:L,NewsForm:q},data(){return{loading:!1,menuItems:j,snackbar:!1,snackbarText:"",snackbarColor:"success"}},methods:{showSnackbar(e,t="success"){this.snackbarText=e,this.snackbarColor=t,this.snackbar=!0},async handleSubmit(e){var t,s;this.loading=!0;try{await B.post("/api/news",e,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),this.showSnackbar("News created successfully"),this.$router.push({name:"News"})}catch(u){console.error("Failed to create news:",u),this.showSnackbar(((s=(t=u.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to create news","error")}finally{this.loading=!1}},handleCancel(){this.$router.push({name:"News"})},logout(){localStorage.removeItem("auth_token"),this.$router.push({name:"Login"})}}});function G(e,t,s,u,C,y){const p=a("news-form"),f=a("v-col"),g=a("v-row"),v=a("v-btn"),h=a("v-snackbar"),b=a("default-layout");return m(),d(b,{title:"Create News","menu-items":e.menuItems,onLogout:e.logout},{default:o(()=>[n(g,null,{default:o(()=>[n(f,{cols:"12",md:"8","offset-md":"2"},{default:o(()=>[n(p,{title:"Create News",loading:e.loading,onSubmit:e.handleSubmit,onCancel:e.handleCancel},null,8,["loading","onSubmit","onCancel"])]),_:1})]),_:1}),n(h,{modelValue:e.snackbar,"onUpdate:modelValue":t[1]||(t[1]=r=>e.snackbar=r),color:e.snackbarColor,timeout:3e3,top:!0,right:!0},{actions:o(()=>[n(v,{color:"white",text:"",onClick:t[0]||(t[0]=r=>e.snackbar=!1)},{default:o(()=>t[2]||(t[2]=[i(" Close ")])),_:1})]),default:o(()=>[i(c(e.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["menu-items","onLogout"])}const M=k(E,[["render",G],["__scopeId","data-v-b373279a"]]);export{M as default};
