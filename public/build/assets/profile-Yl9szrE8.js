import{a as v}from"./index-t--hEgTQ.js";import{d as h,b as u,e as L,u as A,_ as I,c as V,w as t,h as b,o as w,i as l,D as k,x as q,l as g,y as N,E as S,g as T,f as $,V as n}from"./main-DvbPgVvv.js";import{D as c,a as y,b as P,V as j,c as D}from"./DefaultLayout-pjWI6CN4.js";import{B as E,u as F}from"./useAuth-CyrCXpST.js";const M=h({name:"Profile",components:{DefaultLayout:c,BaseButton:E},setup(){const a=A(),{logout:o,isAdmin:m}=F(),d=u(!1),i=u(!1),p=u(!1),f=u(null),s=u({name:"",email:"",username:"",phone:"",dob:"",address:"",current_password:"",new_password:"",new_password_confirmation:""}),e=u(m.value?y:P);L(m,r=>{e.value=r?y:P});const B=async()=>{try{d.value=!0;const r=await v.get("/api/profile/me",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});s.value.name=r.data.user.name,s.value.email=r.data.user.email,s.value.username=r.data.user.username,s.value.phone=r.data.user.phone,s.value.dob=r.data.user.dob,s.value.address=r.data.user.address}catch(r){console.error("Failed to fetch profile:",r)}finally{d.value=!1}},C=async()=>{if(p.value)try{i.value=!0,await v.put("/api/profile/",s.value,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),s.value.current_password="",s.value.new_password="",s.value.new_password_confirmation=""}catch(r){console.error("Failed to save profile:",r)}finally{i.value=!1}},U=async()=>{try{await o(),a.push({name:"Login"})}catch(r){console.error("Logout failed:",r)}};return B(),{menuItems:e,loading:d,saving:i,valid:p,form:f,profile:s,saveProfile:C,handleLogout:U}}});function z(a,o,m,d,i,p){const f=b("BaseButton"),s=b("default-layout");return w(),V(s,{title:"Profile","menu-items":a.menuItems,onLogout:a.handleLogout},{default:t(()=>[l(j,null,{default:t(()=>[l(D,{cols:"12",md:"6","offset-md":"3"},{default:t(()=>[l(k,{class:"dashboard-card",elevation:"3"},{default:t(()=>[l(q,null,{default:t(()=>o[10]||(o[10]=[g("Profile Settings")])),_:1}),l(N,null,{default:t(()=>[a.loading?(w(),V(S,{key:0,indeterminate:"",color:"primary"})):(w(),V(T,{key:1,ref:"form",modelValue:a.valid,"onUpdate:modelValue":o[9]||(o[9]=e=>a.valid=e),onSubmit:$(a.saveProfile,["prevent"])},{default:t(()=>[l(n,{modelValue:a.profile.name,"onUpdate:modelValue":o[0]||(o[0]=e=>a.profile.name=e),label:"Name",rules:[e=>!!e||"Name is required"],required:""},null,8,["modelValue","rules"]),l(n,{modelValue:a.profile.email,"onUpdate:modelValue":o[1]||(o[1]=e=>a.profile.email=e),label:"Email",rules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Email must be valid"],required:""},null,8,["modelValue","rules"]),l(n,{modelValue:a.profile.username,"onUpdate:modelValue":o[2]||(o[2]=e=>a.profile.username=e),label:"Username",rules:[e=>!!e||"Username is required"],required:""},null,8,["modelValue","rules"]),l(n,{modelValue:a.profile.phone,"onUpdate:modelValue":o[3]||(o[3]=e=>a.profile.phone=e),label:"Phone"},null,8,["modelValue"]),l(n,{modelValue:a.profile.dob,"onUpdate:modelValue":o[4]||(o[4]=e=>a.profile.dob=e),label:"Date of Birth",type:"date"},null,8,["modelValue"]),l(n,{modelValue:a.profile.address,"onUpdate:modelValue":o[5]||(o[5]=e=>a.profile.address=e),label:"Address"},null,8,["modelValue"]),l(n,{modelValue:a.profile.current_password,"onUpdate:modelValue":o[6]||(o[6]=e=>a.profile.current_password=e),label:"Current Password",type:"password",rules:[e=>!e||e.length>=8||"Password must be at least 8 characters"]},null,8,["modelValue","rules"]),l(n,{modelValue:a.profile.new_password,"onUpdate:modelValue":o[7]||(o[7]=e=>a.profile.new_password=e),label:"New Password",type:"password",rules:[e=>!e||e.length>=8||"Password must be at least 8 characters"]},null,8,["modelValue","rules"]),l(n,{modelValue:a.profile.new_password_confirmation,"onUpdate:modelValue":o[8]||(o[8]=e=>a.profile.new_password_confirmation=e),label:"Confirm New Password",type:"password",rules:[e=>!e||e===a.profile.new_password||"Passwords must match"]},null,8,["modelValue","rules"]),l(f,{color:"primary",type:"submit",loading:a.saving,disabled:!a.valid},{default:t(()=>o[11]||(o[11]=[g(" Save Changes ")])),_:1},8,["loading","disabled"])]),_:1},8,["modelValue","onSubmit"]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["menu-items","onLogout"])}const K=I(M,[["render",z],["__scopeId","data-v-635cc871"]]);export{K as default};
