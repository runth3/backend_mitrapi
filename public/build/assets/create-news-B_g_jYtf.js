import{a as fe}from"./index-t--hEgTQ.js";import{K as ve,L as ge,M as he,N as we,O as pe,A as D,b as m,P as Ve,Q as be,p as ye,e as x,R as Ce,S as xe,T as Fe,U as J,W as K,i as a,m as A,X as ke,Y as Pe,Z as Ie,$ as G,a0 as Se,a1 as Be,G as N,a2 as Re,a3 as Q,a4 as De,a5 as Ne,a6 as Te,d as ee,_ as te,c as T,w as o,D as $e,o as I,x as Ue,l as F,t as $,y as ze,g as Le,f as Me,j as Ae,V as Ge,q as He,H as je,v as Ee,z as X,u as Oe,h as H}from"./main-iU3nZ3Bq.js";import{V as ae,c as le,D as qe,a as Y,b as Z}from"./DefaultLayout-B5QFGmuT.js";import{V as _e}from"./VFileInput-Etimgh95.js";import{V as We}from"./VChip-BQ0ep0Tc.js";import{B as Je,u as Ke}from"./useAuth-Ij3fNG1k.js";import{V as Qe}from"./VSnackbar-DoHIk5db.js";const Xe=ge({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...Ie(),...Pe()},"VTextarea"),Ye=ve()({name:"VTextarea",directives:{Intersect:he},inheritAttrs:!1,props:Xe(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:s,emit:h,slots:r}=t;const i=we(e,"modelValue"),{isFocused:l,focus:f,blur:b}=pe(e),k=D(()=>typeof e.counterValue=="function"?e.counterValue(i.value):(i.value||"").toString().length),j=D(()=>{if(s.maxlength)return s.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function E(n,d){var u,g;!e.autofocus||!n||(g=(u=d[0].target)==null?void 0:u.focus)==null||g.call(u)}const c=m(),v=m(),P=Ve(""),V=m(),ne=D(()=>e.persistentPlaceholder||l.value||e.active);function U(){var n;V.value!==document.activeElement&&((n=V.value)==null||n.focus()),l.value||f()}function oe(n){U(),h("click:control",n)}function ie(n){h("mousedown:control",n)}function se(n){n.stopPropagation(),U(),G(()=>{i.value="",Te(e["onClick:clear"],n)})}function re(n){var u;const d=n.target;if(i.value=d.value,(u=e.modelModifiers)!=null&&u.trim){const g=[d.selectionStart,d.selectionEnd];G(()=>{d.selectionStart=g[0],d.selectionEnd=g[1]})}}const y=m(),S=m(Number(e.rows)),z=D(()=>["plain","underlined"].includes(e.variant));be(()=>{e.autoGrow||(S.value=Number(e.rows))});function C(){e.autoGrow&&G(()=>{if(!y.value||!v.value)return;const n=getComputedStyle(y.value),d=getComputedStyle(v.value.$el),u=parseFloat(n.getPropertyValue("--v-field-padding-top"))+parseFloat(n.getPropertyValue("--v-input-padding-top"))+parseFloat(n.getPropertyValue("--v-field-padding-bottom")),g=y.value.scrollHeight,B=parseFloat(n.lineHeight),L=Math.max(parseFloat(e.rows)*B+u,parseFloat(d.getPropertyValue("--v-input-control-height"))),M=parseFloat(e.maxRows)*B+u||1/0,p=Be(g??0,L,M);S.value=Math.floor((p-u)/B),P.value=Se(p)})}ye(C),x(i,C),x(()=>e.rows,C),x(()=>e.maxRows,C),x(()=>e.density,C);let w;return x(y,n=>{n?(w=new ResizeObserver(C),w.observe(y.value)):w==null||w.disconnect()}),Ce(()=>{w==null||w.disconnect()}),xe(()=>{const n=!!(r.counter||e.counter||e.counterValue),d=!!(n||r.details),[u,g]=Fe(s),{modelValue:B,...L}=J.filterProps(e),M=K.filterProps(e);return a(J,A({ref:c,modelValue:i.value,"onUpdate:modelValue":p=>i.value=p,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":z.value},e.class],style:e.style},u,L,{centerAffix:S.value===1&&!z.value,focused:l.value}),{...r,default:p=>{let{id:R,isDisabled:O,isDirty:q,isReadonly:ue,isValid:de}=p;return a(K,A({ref:v,style:{"--v-textarea-control-height":P.value},onClick:oe,onMousedown:ie,"onClick:clear":se,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},M,{id:R.value,active:ne.value||q.value,centerAffix:S.value===1&&!z.value,dirty:q.value||e.dirty,disabled:O.value,focused:l.value,error:de.value===!1}),{...r,default:ce=>{let{props:{class:_,...W}}=ce;return a(N,null,[e.prefix&&a("span",{class:"v-text-field__prefix"},[e.prefix]),Q(a("textarea",A({ref:V,class:_,value:i.value,onInput:re,autofocus:e.autofocus,readonly:ue.value,disabled:O.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:U,onBlur:b},W,g),null),[[De("intersect"),{handler:E},null,{once:!0}]]),e.autoGrow&&Q(a("textarea",{class:[_,"v-textarea__sizer"],id:`${W.id}-sizer`,"onUpdate:modelValue":me=>i.value=me,ref:y,readonly:!0,"aria-hidden":"true"},null),[[Ne,i.value]]),e.suffix&&a("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:d?p=>{var R;return a(N,null,[(R=r.details)==null?void 0:R.call(r,p),n&&a(N,null,[a("span",null,null),a(Re,{active:e.persistentCounter||l.value,value:k.value,max:j.value,disabled:e.disabled},r.counter)])])}:void 0})}),ke({},c,v,V)}}),Ze=ee({name:"NewsForm",props:{title:{type:String,default:"Create News"},submitButtonText:{type:String,default:"Create"},initialData:{type:Object,default:()=>({title:"",content:"",image_url:""})},loading:{type:Boolean,default:!1}},data(){return{valid:!1,formData:{...this.initialData},imageFile:null,imagePreview:null,imageRules:[e=>{if(!e)return!0;const t=5*1024*1024;return e.size>t?"Image size should be less than 5MB!":["image/jpeg","image/png","image/gif","image/webp"].includes(e.type)?!0:"Please upload an image file (JPEG, PNG, GIF, WEBP)"}]}},methods:{handleImageChange(e){e?(this.imagePreview=URL.createObjectURL(e),this.imageFile=e):this.clearImage()},clearImage(){this.imagePreview&&URL.revokeObjectURL(this.imagePreview),this.imagePreview=null,this.imageFile=null},async handleSubmit(){const e=this.$refs.form,{valid:t}=await e.validate();if(t){const s=new FormData;s.append("title",this.formData.title),s.append("content",this.formData.content),this.imageFile&&s.append("image",this.imageFile),this.$emit("submit",s)}}},beforeUnmount(){this.clearImage()},watch:{initialData:{handler(e){this.formData={...e},e.image_url&&(this.imagePreview=e.image_url)},immediate:!0}}});function et(e,t,s,h,r,i){return I(),T($e,null,{default:o(()=>[a(Ue,null,{default:o(()=>[F($(e.title),1)]),_:1}),a(ze,null,{default:o(()=>[a(Le,{ref:"form",modelValue:e.valid,"onUpdate:modelValue":t[4]||(t[4]=l=>e.valid=l),onSubmit:Me(e.handleSubmit,["prevent"])},{default:o(()=>[a(Ge,{modelValue:e.formData.title,"onUpdate:modelValue":t[0]||(t[0]=l=>e.formData.title=l),rules:[l=>!!l||"Title is required"],label:"Title",required:"",variant:"outlined","full-width":"",class:"mb-4"},null,8,["modelValue","rules"]),a(Ye,{modelValue:e.formData.content,"onUpdate:modelValue":t[1]||(t[1]=l=>e.formData.content=l),rules:[l=>!!l||"Content is required"],label:"Content",required:"",variant:"outlined","full-width":"",class:"mb-4",rows:"10","auto-grow":""},null,8,["modelValue","rules"]),a(_e,{modelValue:e.imageFile,"onUpdate:modelValue":t[2]||(t[2]=l=>e.imageFile=l),rules:e.imageRules,accept:"image/*",label:"News Image",variant:"outlined","prepend-icon":"mdi-camera","full-width":"",class:"mb-4",onChange:e.handleImageChange,"show-size":!0},{selection:o(({fileNames:l})=>[(I(!0),He(N,null,je(l,f=>(I(),T(We,{key:f,size:"small",label:"",color:"primary",class:"me-2"},{default:o(()=>[F($(f),1)]),_:2},1024))),128))]),_:1},8,["modelValue","rules","onChange"]),e.imagePreview?(I(),T(Ee,{key:0,src:e.imagePreview,"max-height":"200",contain:"",class:"mb-4"},null,8,["src"])):Ae("",!0),a(ae,null,{default:o(()=>[a(le,{cols:"12",class:"d-flex justify-end"},{default:o(()=>[a(X,{color:"secondary",variant:"text",class:"mr-2",onClick:t[3]||(t[3]=l=>e.$emit("cancel"))},{default:o(()=>t[5]||(t[5]=[F(" Cancel ")])),_:1}),a(X,{color:"primary",type:"submit",loading:e.loading,disabled:!e.valid},{default:o(()=>[F($(e.submitButtonText),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1})}const tt=te(Ze,[["render",et]]),at=ee({name:"CreateNews",components:{DefaultLayout:qe,NewsForm:tt,BaseButton:Je},setup(){const e=Oe(),{logout:t,isAdmin:s}=Ke(),h=m(!1),r=m(!1),i=m(""),l=m("success"),f=m(s.value?Y:Z);x(s,c=>{f.value=c?Y:Z});const b=(c,v="success")=>{i.value=c,l.value=v,r.value=!0};return{menuItems:f,loading:h,snackbar:r,snackbarText:i,snackbarColor:l,handleSubmit:async c=>{var v,P;h.value=!0;try{await fe.post("/api/news",c,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),b("News created successfully"),e.push({name:"news"})}catch(V){console.error("Failed to create news:",V),b(((P=(v=V.response)==null?void 0:v.data)==null?void 0:P.message)||"Failed to create news","error")}finally{h.value=!1}},handleCancel:()=>{e.push({name:"news"})},handleLogout:async()=>{try{await t(),e.push({name:"Login"})}catch(c){console.error("Logout failed:",c)}}}}});function lt(e,t,s,h,r,i){const l=H("news-form"),f=H("BaseButton"),b=H("default-layout");return I(),T(b,{title:"Create News","menu-items":e.menuItems,onLogout:e.handleLogout},{default:o(()=>[a(ae,null,{default:o(()=>[a(le,{cols:"12",md:"8","offset-md":"2"},{default:o(()=>[a(l,{title:"Create News",loading:e.loading,onSubmit:e.handleSubmit,onCancel:e.handleCancel},null,8,["loading","onSubmit","onCancel"])]),_:1})]),_:1}),a(Qe,{modelValue:e.snackbar,"onUpdate:modelValue":t[1]||(t[1]=k=>e.snackbar=k),color:e.snackbarColor,timeout:3e3,location:"top",vertical:""},{actions:o(()=>[a(f,{color:"white",variant:"text",onClick:t[0]||(t[0]=k=>e.snackbar=!1)},{default:o(()=>t[2]||(t[2]=[F(" Close ")])),_:1})]),default:o(()=>[F($(e.snackbarText)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["menu-items","onLogout"])}const ct=te(at,[["render",lt],["__scopeId","data-v-e30597a9"]]);export{ct as default};
