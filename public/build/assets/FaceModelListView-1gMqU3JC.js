import{a as I}from"./index-t--hEgTQ.js";import{d as P,b as s,e as B,p as G,_ as q,c,w as t,o as i,i as l,D as A,x as J,l as u,z as w,y as O,q as H,E as K,v as oe,B as D,u as le,F as ne,h as b,s as T,j as z,t as C,G as re,H as se,I as ie,n as de,J as ue,a as N}from"./main-DvbPgVvv.js";import{d as ce,D as me,a as R,b as E,V as F,c as $,e as j}from"./DefaultLayout-pjWI6CN4.js";import{V as pe}from"./VDialog-DmfLH6S0.js";import{B as fe,u as ge}from"./useAuth-CyrCXpST.js";import{V as ye}from"./VFileInput-BZiqEOXM.js";import"./VChip-CRE1ALfE.js";const ve=P({name:"FaceModelImageView",props:{faceModelId:{type:Number,required:!0},userId:{type:Number,required:!0},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:o}){const f=s(!0),h=s(null),p=s(e.modelValue);B(()=>e.modelValue,d=>{p.value=d}),B(p,d=>{o("update:modelValue",d)});const g=async()=>{if(e.faceModelId){f.value=!0;try{const d=await I.get(`/api/face-model/${e.faceModelId}`,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},responseType:"blob"});h.value=URL.createObjectURL(d.data)}catch(d){console.error("Failed to fetch image:",d)}finally{f.value=!1}}},m=()=>{console.error("Failed to load image")},y=()=>{o("update:modelValue",!1)};return G(()=>{g()}),{loading:f,imageUrl:h,handleImageError:m,dialog:p,closeModal:y}}}),Ie={key:1};function he(e,o,f,h,p,g){return i(),c(pe,{modelValue:e.dialog,"onUpdate:modelValue":o[0]||(o[0]=m=>e.dialog=m),"max-width":"600"},{default:t(()=>[l(A,null,{default:t(()=>[l(J,null,{default:t(()=>[o[1]||(o[1]=u(" Face Model Image ")),l(ce),l(w,{icon:"mdi-close",onClick:e.closeModal},null,8,["onClick"])]),_:1}),l(O,null,{default:t(()=>[e.loading?(i(),c(K,{key:0,indeterminate:"",color:"primary"})):(i(),H("div",Ie,[e.imageUrl?(i(),c(oe,{key:0,src:e.imageUrl,"aspect-ratio":"1",class:"grey lighten-2",cover:"",onError:e.handleImageError},null,8,["src","onError"])):(i(),c(D,{key:1},{default:t(()=>o[2]||(o[2]=[u("mdi-image-broken")])),_:1}))]))]),_:1})]),_:1})]),_:1},8,["modelValue"])}const Ve=q(ve,[["render",he]]),ke=P({name:"FaceModelListView",components:{DefaultLayout:me,FaceModelImageView:Ve,BaseButton:fe},setup(){const e=s(null),o=ne(),f=le(),{logout:h,isAdmin:p}=ge(),g=s(!0),m=s(!1),y=s(!1),d=s([]),r=s(!1),k=s(null),v=s(null),L=s(null),U=s({}),_=s(null),S=s(p.value?R:E);B(p,a=>{S.value=a?R:E}),B(()=>o.params.id,a=>{if(a){const n=parseInt(a,10);isNaN(n)?(e.value=null,console.error("Invalid User ID in route parameters:",a)):(e.value=n,X())}else e.value=null,console.error("User ID not found in route parameters.")},{immediate:!0});const Q=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),W=async a=>{try{const n=await I.get(`/api/face-model/${a}`,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},responseType:"blob"}),V=URL.createObjectURL(n.data);U.value[a]=V}catch(n){console.error(`Failed to fetch image for ID ${a}:`,n)}},X=async()=>{if(e.value)try{const a=await I.get(`/api/users/${e.value}`,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});_.value={username:a.data.user.username,name:a.data.user.name}}catch(a){console.error("Failed to fetch user details:",a)}},M=async()=>{if(e.value){g.value=!0;try{const a=await I.get(`/api/face-model/user/${e.value}`,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});d.value=a.data;for(const n of d.value)await W(n.id)}catch(a){console.error("Failed to fetch face models:",a)}finally{g.value=!1}}},Y=async(a,n)=>{m.value=!0;try{await I.put(`/api/face-model/${a}/set-active`,{},{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),M()}catch(V){console.error("Failed to update face model:",V)}finally{m.value=!1}},Z=a=>{const n=a.target;if(n.files&&n.files.length>0){const V=n.files[0];if(!["image/jpeg","image/png","image/jpg"].includes(V.type)){alert("Please select a valid image file (JPEG, PNG, JPG)."),v.value=null;return}v.value=V}else v.value=null},x=async()=>{if(!(!v.value||!e.value)){y.value=!0;try{const a=new FormData;a.append("image",v.value),a.append("user_id",e.value.toString()),await I.post("/api/face-model",a,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),M(),v.value=null,L.value.reset()}catch(a){console.error("Failed to upload face model:",a)}finally{y.value=!1}}},ee=(a,n)=>{k.value=a,r.value=!0},ae=async a=>{try{await I.delete(`/api/face-model/${a}`,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),M()}catch(n){console.error("Failed to delete face model:",n)}},te=async()=>{try{await h(),f.push({name:"Login"})}catch(a){console.error("Logout failed:",a)}};return G(()=>{M()}),{menuItems:S,userId:e,handleLogout:te,loading:g,toggleLoading:m,uploading:y,faceModels:d,showImageModal:r,selectedFaceModelId:k,openImageModal:ee,imageFile:v,fileInput:L,handleToggleActive:Y,handleImageChange:Z,handleUpload:x,handleDelete:ae,formatDate:Q,imageBlobs:U,userDetails:_}}});function Ce(e,o,f,h,p,g){const m=b("BaseButton"),y=b("FaceModelImageView"),d=b("default-layout");return i(),c(d,{title:"Face Model List","menu-items":e.menuItems,onLogout:e.handleLogout},{default:t(()=>[e.userId?(i(),c(T,{key:0},{default:t(()=>[l(A,{class:"dashboard-card",elevation:"3"},{default:t(()=>[e.userDetails?(i(),c(J,{key:0},{default:t(()=>[u(" Face Models: "+C(e.userDetails.username)+" / "+C(e.userDetails.name),1)]),_:1})):z("",!0),l(O,null,{default:t(()=>[l(F,{class:"mt-4"},{default:t(()=>[l($,{cols:"12"},{default:t(()=>[l(ye,{ref:"fileInput",label:"Upload New Face Model",accept:"image/png, image/jpeg, image/jpg","prepend-icon":"mdi-camera",class:"mt-4",onChange:e.handleImageChange},null,8,["onChange"]),l(m,{color:"primary",class:"mt-2",loading:e.uploading,disabled:!e.imageFile,onClick:e.handleUpload},{default:t(()=>o[1]||(o[1]=[u(" Upload ")])),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1}),e.loading?(i(),c(K,{key:0,indeterminate:"",color:"primary"})):e.faceModels.length>0?(i(),c(F,{key:1,class:"mt-6"},{default:t(()=>[(i(!0),H(re,null,se(e.faceModels,r=>(i(),c($,{key:r.id,cols:"12",sm:"6",md:"3"},{default:t(()=>[l(A,{elevation:"4",class:de(["pa-4 image-card",{"active-card":r.is_active}]),style:ie({backgroundImage:`url(${e.imageBlobs[r.id]||""})`})},{default:t(()=>[l(F,{align:"center",justify:"center",class:"fill-height","no-gutters":""},{default:t(()=>[l($,{cols:"12",class:"text-center"},{default:t(()=>[l(w,{icon:"",variant:"text",onClick:k=>e.openImageModal(r.id,e.userId)},{default:t(()=>[l(D,null,{default:t(()=>o[2]||(o[2]=[u("mdi-eye")])),_:1}),l(j,{activator:"parent",location:"top"},{default:t(()=>o[3]||(o[3]=[u(" View Image ")])),_:1})]),_:2},1032,["onClick"]),l(w,{icon:"",color:r.is_active?"success":"primary",variant:"text",loading:e.toggleLoading,onClick:k=>e.handleToggleActive(r.id,r)},{default:t(()=>[l(D,null,{default:t(()=>[u(C(r.is_active?"mdi-check-circle":"mdi-circle-edit-outline"),1)]),_:2},1024),l(j,{activator:"parent",location:"top"},{default:t(()=>[u(C(r.is_active?"Active":"Set as Active"),1)]),_:2},1024)]),_:2},1032,["color","loading","onClick"]),l(w,{icon:"",color:"error",variant:"text",onClick:k=>e.handleDelete(r.id)},{default:t(()=>[l(D,null,{default:t(()=>o[4]||(o[4]=[u("mdi-delete")])),_:1}),l(j,{activator:"parent",location:"top"},{default:t(()=>o[5]||(o[5]=[u(" Delete ")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),l(F,{"no-gutters":""},{default:t(()=>[l($,{cols:"12",class:"date-container"},{default:t(()=>[l(ue,{class:"date-text"},{default:t(()=>[u(" Created: "+C(e.formatDate(r.created_at)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class","style"])]),_:2},1024))),128))]),_:1})):(i(),c(N,{key:2,type:"info",class:"mt-6"},{default:t(()=>o[6]||(o[6]=[u(" No face models found for this user. ")])),_:1}))]),_:1})]),_:1}),e.selectedFaceModelId&&e.showImageModal?(i(),c(y,{key:0,modelValue:e.showImageModal,"onUpdate:modelValue":o[0]||(o[0]=r=>e.showImageModal=r),faceModelId:e.selectedFaceModelId,userId:e.userId},null,8,["modelValue","faceModelId","userId"])):z("",!0)]),_:1})):(i(),c(T,{key:1},{default:t(()=>[l(N,{type:"error"},{default:t(()=>o[7]||(o[7]=[u(" User ID not found or invalid. Please check the URL. ")])),_:1})]),_:1}))]),_:1},8,["menu-items","onLogout"])}const je=q(ke,[["render",Ce],["__scopeId","data-v-6e9a6673"]]);export{je as default};
