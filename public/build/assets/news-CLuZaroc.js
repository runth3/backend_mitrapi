import{a as A}from"./index-t--hEgTQ.js";import{d as P,_ as $,c as m,w as o,D as B,o as r,i as n,j as f,x as b,l as w,z as T,B as j,y as q,q as N,E,G as S,H as z,C as F,ai as M,b as d,e as R,u as _,h as v}from"./main-DvbPgVvv.js";import{d as G,f as H,g as U,D as J,a as C,b as h,V as K,c as O}from"./DefaultLayout-pjWI6CN4.js";import{V as Q}from"./VPagination-CQjHGj8I.js";import{u as W}from"./useAuth-CyrCXpST.js";const X=P({name:"NewsList",props:{items:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1},currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0}},methods:{formatDate(e){try{if(!e)return"No date";const t=new Date(e);if(isNaN(t.getTime()))return"Invalid date";const i={year:"numeric",month:"long",day:"numeric"};return t.toLocaleDateString(void 0,i)}catch(t){return console.error("Error formatting date:",t),"Invalid date"}}},mounted(){console.log("NewsList items:",this.items)}}),Y={key:2,class:"text-center pa-4"};function Z(e,t,i,u,p,g){return r(),m(B,null,{default:o(()=>[n(b,null,{default:o(()=>[t[5]||(t[5]=w(" News ")),n(G),n(T,{color:"primary",onClick:t[0]||(t[0]=a=>e.$emit("create"))},{default:o(()=>[n(j,{left:""},{default:o(()=>t[3]||(t[3]=[w("mdi-plus")])),_:1}),t[4]||(t[4]=w(" Create News "))]),_:1})]),_:1}),n(q,null,{default:o(()=>[e.loading?(r(),m(E,{key:0,indeterminate:"",color:"primary"})):f("",!0),e.items&&e.items.length>0?(r(),m(H,{key:1},{default:o(()=>[(r(!0),N(S,null,z(e.items,a=>(r(),m(U,{key:a.id,onClick:c=>e.$emit("view",a.id),title:a.title,subtitle:e.formatDate(a.created_at)},null,8,["onClick","title","subtitle"]))),128))]),_:1})):e.loading?f("",!0):(r(),N("div",Y,t[6]||(t[6]=[F("p",null,"No news items found",-1)])))]),_:1}),e.totalPages>1?(r(),m(M,{key:0,class:"justify-center pa-4"},{default:o(()=>[n(Q,{modelValue:e.currentPage,"onUpdate:modelValue":[t[1]||(t[1]=a=>e.currentPage=a),t[2]||(t[2]=a=>e.$emit("page-change",a))],length:e.totalPages,"total-visible":7,color:"primary"},null,8,["modelValue","length"])]),_:1})):f("",!0)]),_:1})}const x=$(X,[["render",Z]]),ee=P({name:"News",components:{DefaultLayout:J,NewsList:x},setup(){const e=_(),{logout:t,isAdmin:i}=W(),u=d([]),p=d(!1),g=d(1),a=d(1),c=d(20),y=d(i.value?C:h);R(i,s=>{y.value=s?C:h});const V=async(s=1)=>{try{p.value=!0;const l=await A.get("/api/news",{params:{page:s,per_page:c.value},headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});Array.isArray(l.data.data)?(u.value=l.data.data,g.value=l.data.current_page,a.value=l.data.last_page):(console.error("Invalid response format:",l.data),u.value=[])}catch(l){console.error("Failed to fetch news:",l),u.value=[]}finally{p.value=!1}},L=s=>{V(s)},k=s=>{e.push({name:"newsDetail",params:{id:s}})},I=()=>{e.push({name:"createNews"})},D=async()=>{try{await t(),e.push({name:"Login"})}catch(s){console.error("Logout failed:",s)}};return V(),{menuItems:y,news:u,loading:p,currentPage:g,totalPages:a,handlePageChange:L,viewNews:k,createNews:I,handleLogout:D}}});function te(e,t,i,u,p,g){const a=v("news-list"),c=v("default-layout");return r(),m(c,{title:"News","menu-items":e.menuItems,onLogout:e.handleLogout},{default:o(()=>[n(K,null,{default:o(()=>[n(O,{cols:"12"},{default:o(()=>[n(a,{items:e.news,loading:e.loading,"total-pages":e.totalPages,"current-page":e.currentPage,onView:e.viewNews,onCreate:e.createNews,onPageChange:e.handlePageChange},null,8,["items","loading","total-pages","current-page","onView","onCreate","onPageChange"])]),_:1})]),_:1})]),_:1},8,["menu-items","onLogout"])}const le=$(ee,[["render",te]]);export{le as default};
